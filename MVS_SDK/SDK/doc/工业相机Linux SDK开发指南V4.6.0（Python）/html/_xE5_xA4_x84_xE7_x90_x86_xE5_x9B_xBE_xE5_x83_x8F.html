<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="custom-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
	<div style="overflow: hidden;">
		<div style="height: 57px;min-width: 1039px;background-size: auto 100%;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABwgAAAABCAYAAADKO/rAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABRSURBVFhH7dUxCoBADEXB5LK5/w1iIaLIrsgWNs50Sf/4WVUd8HOZGd1nCqMbGNMPrNMPrJv1cvz0A3OjfuwPvDPrxf7A7t7IlX7gmX74VsQGguw4S6+UnSYAAAAASUVORK5CYII=');">
			<img src="titleleft.png" style="float: left;"/>
			<img src="titleright.png" alt="" style="float: right;" />
		</div>
	</div>
<!-- 制作者 Doxygen 1.8.15 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>首页</span></a></li>
      <li><a href="_xE5_x8F_x91_xE7_x89_x88_xE8_xAF_xB4_xE6_x98_x8E.html"><span>发版说明</span></a></li>
      <li><a href="_xE7_xBC_x96_xE7_xA8_x8B_xE5_xBC_x95_xE5_xAF_xBC.html"><span>编程引导</span></a></li>
      <li><a href="modules.html"><span>API参考</span></a></li>
      <li><a href="_xE7_xA4_xBA_xE4_xBE_x8B_xE7_xA8_x8B_xE5_xBA_x8F_xE6_xA6_x82_xE8_xA7_x88.html"><span>示例程序概览</span></a></li>
      <li><a href="_xE5_xB8_xB8_xE8_xA7_x81_xE9_x97_xAE_xE9_xA2_x98.html"><span>常见问题</span></a></li>
      <li><a href="_xE6_xB3_x95_xE5_xBE_x8B_xE5_xA3_xB0_xE6_x98_x8E.html"><span>法律声明</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="PageDoc"><div class="contents">
<div class="textblock"><div class="header" style="margin-left:-12px;margin-top:-10px;margin-right:-8px;"> <div class="headertitle"> <div class="title">处理图像</div> </div> </div> <div id="shortdesc"> <br />
 </div><div id="shortdesc">SDK提供了丰富的图像处理接口，可用于实现图像显示、图像保存、像素格式转换、图像重组和录像等功能。采集到图像后，您可以直接其传入到这些接口中进行图像处理。</div><div id="shortdesc"> <br />
 </div><div id="shortdesc">本节内容包含：</div><div id="shortdesc"> <ul>
<li>
<a href="#render">图像渲染</a> </li>
<li>
<a href="#save">保存图像</a> </li>
<li>
<a href="#pixelFormat">像素格式转换</a> </li>
<li>
<a href="#decode">解码图像</a> </li>
<li>
<a href="#record">录像</a> </li>
<li>
<a href="#reconstruct">分时曝光拆图</a> </li>
</ul>
</div><div> <div id="render"> <div class="mainparams"> <h2>图像渲染</h2>
</div></div></div><div><div id="render"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="render"><div class="subparamswhite">采集到图像后，您可参照如下示例，调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#gac04bec4e09806381bb2a25949ca90598" title="显示一帧图像">MV_CC_DisplayOneFrameEx2()</a> 将图像显示在指定窗口。</div></div></div><div><div id="render"><div class="subparamswhite"> <div class="fragment"><div class="line">displayimage = MV_CC_IMAGE()</div><div class="line">displayimage.nWidth = stOutFrame.stFrameInfo.nWidth </div><div class="line">displayimage.nHeight =  stOutFrame.stFrameInfo.nHeight </div><div class="line">displayimage.enPixelType =  stOutFrame.stFrameInfo.enPixelType </div><div class="line">displayimage.pImageBuf = stOutFrame.pBufAddr</div><div class="line">displayimage.nImageBuffSize = stOutFrame.stFrameInfo.nFrameLen</div><div class="line">displayimage.nImageLen =    stOutFrame.stFrameInfo.nFrameLen</div><div class="line">ret = cam.MV_CC_DisplayOneFrameEx2(int(hwnd),displayimage, 0)</div><div class="line"><span class="keywordflow">if</span> ret != 0:</div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;MV_CC_DisplayOneFrameEx2 fail! ret[0x%x]&quot;</span> % ret)</div></div><!-- fragment --> <ol>
<li>
获取图像宽、高、像素格式、图像缓存及图像长度。 </li>
<li>
设置图像渲染模式。此处设置为0，表示默认模式，即通过GDI模式渲染。 </li>
<li>
通过 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#gac04bec4e09806381bb2a25949ca90598" title="显示一帧图像">MV_CC_DisplayOneFrameEx2()</a> 将获取的图像通过指定模式渲染。 </li>
</ol>
</div><p> <br />
 </div> <div id="save"> <div class="mainparams"> <h2>保存图像</h2>
</div></div></div><div><div id="save"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="save"><div class="subparamswhite">在采集到图像后，您可将图像保存至本地或内存中：</div></div></div><div><div id="save"><div class="subparamswhite"> <ul>
<li>
保存至本地：调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#gaad39773c3e16e5a3c94ff0aad8d17f22" title="保存图像到文件">MV_CC_SaveImageToFileEx2()</a> 。 </li>
<li>
保存至内存：调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga66ec7fec9bcb33be5c06c76a0b2a50be" title="保存图片，支持Bmp和Jpeg.">MV_CC_SaveImageEx3()</a> 。 </li>
</ul>
</div></div></div><div><div id="save"><div class="subparamswhite">如下示例代码演示了如何将图像保存成本地BMP文件。</div></div></div><div><div id="save"><div class="subparamswhite"> <div class="fragment"><div class="line"><span class="comment"># 保存bmp图片</span></div><div class="line">c_file_path = file_path.encode(<span class="stringliteral">&#39;ascii&#39;</span>)</div><div class="line">stSaveParam = MV_SAVE_IMAGE_TO_FILE_PARAM_EX()</div><div class="line">stSaveParam.enPixelType = frame_info.stFrameInfo.enPixelType  <span class="comment"># ch:图像的像素格式 | en:Camera pixel type</span></div><div class="line">stSaveParam.nWidth = frame_info.stFrameInfo.nWidth  <span class="comment"># ch:图像的宽 | en:Width</span></div><div class="line">stSaveParam.nHeight = frame_info.stFrameInfo.nHeight  <span class="comment"># ch:图像的高 | en:Height</span></div><div class="line">stSaveParam.nDataLen = frame_info.stFrameInfo.nFrameLen</div><div class="line">stSaveParam.pData = frame_info.pBufAddr</div><div class="line">stSaveParam.enImageType = MV_Image_Bmp  <span class="comment"># ch:需要保存的图像类型 | en:Image format to save</span></div><div class="line">stSaveParam.pcImagePath = create_string_buffer(c_file_path)</div><div class="line">stSaveParam.iMethodValue = 1</div><div class="line">stSaveParam.nQuality = 80  <span class="comment"># ch: JPG: (50,99], invalid in other format</span></div><div class="line">ret = cam.MV_CC_SaveImageToFileEx(stSaveParam)</div></div><!-- fragment --> </div><p> <br />
 </div> <div id="pixelFormat"> <div class="mainparams"> <h2>像素格式转换</h2>
</div></div></div><div><div id="pixelFormat"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="pixelFormat"><div class="subparamswhite">采集到图像后，您可调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#gaa87493ab64f207c8117d8d8a8b6b3b69" title="像素格式转换">MV_CC_ConvertPixelTypeEx()</a> ，将图像转换成其他像素格式。</div></div></div><div><div id="pixelFormat"><div class="subparamswhite"> </div></div></div><div><div id="pixelFormat"><div class="subparamswhite">例如，您可将Bayer格式转换成RGB/BGR格式。在对Bayer格式图像进行插值时，还支持一些算法功能，如平滑滤波、Gamma矫正和CCM矫正等，具体支持的功能，可参考<a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html">图像处理</a> 相关内容。</div></div></div><div><div id="pixelFormat"><div class="subparamswhite"> </div></div></div><div><div id="pixelFormat"><div class="subparamswhite">如下示例代码演示了如何将图像转换成RGB格式。</div></div></div><div><div id="pixelFormat"><div class="subparamswhite"> <div class="fragment"><div class="line">nRGBSize = stOutFrame.stFrameInfo.nWidth * stOutFrame.stFrameInfo.nHeight * 3</div><div class="line">stConvertParam = MV_CC_PIXEL_CONVERT_PARAM_EX()</div><div class="line">memset(byref(stConvertParam), 0, sizeof(stConvertParam))</div><div class="line">stConvertParam.nWidth = stOutFrame.stFrameInfo.nWidth</div><div class="line">stConvertParam.nHeight = stOutFrame.stFrameInfo.nHeight</div><div class="line">stConvertParam.pSrcData = stOutFrame.pBufAddr</div><div class="line">stConvertParam.nSrcDataLen = stOutFrame.stFrameInfo.nFrameLen</div><div class="line">stConvertParam.enSrcPixelType = stOutFrame.stFrameInfo.enPixelType  </div><div class="line">stConvertParam.enDstPixelType = PixelType_Gvsp_RGB8_Packed</div><div class="line">stConvertParam.pDstBuffer = (c_ubyte * nRGBSize)()</div><div class="line">stConvertParam.nDstBufferSize = nRGBSize</div><div class="line"></div><div class="line">ret = cam.MV_CC_ConvertPixelTypeEx(stConvertParam)</div><div class="line"><span class="keywordflow">if</span> ret != 0:</div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;convert pixel fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    sys.exit()</div></div><!-- fragment --> </div><p> <br />
 </div> <div id="decode"> <div class="mainparams"> <h2>解码图像</h2>
</div></div></div><div><div id="decode"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="decode"><div class="subparamswhite">部分相机支持对图像进行编码压缩，发送压缩的图像，用户可以调用 MV_CC_HB_Decode() 对图像进行解码。</div></div></div><div><div id="decode"><div class="subparamswhite"> <dl class="section attention"><dt>注意</dt><dd>解码前需要判断输入图像是否完整，如果因为网络等因素导致图像丢失了部分数据包，该接口可能会解码失败。 您可以通过 MV_FRAME_OUT_INFO_EX 结构体中的nLostPacket（本帧丢包数）字段，进行检测，如果nLostPacket大于0，则当前帧有丢包。</dd></dl>
</div></div></div><div><div id="decode"><div class="subparamswhite">如下示例代码演示了如何解码压缩图像。</div></div></div><div><div id="decode"><div class="subparamswhite"> <div class="fragment"><div class="line"><span class="comment"># ch:解码参数 | en: decode parameters</span></div><div class="line">stDecodeParam = MV_CC_HB_DECODE_PARAM()</div><div class="line"></div><div class="line"><span class="comment"># 获取数据包大小</span></div><div class="line">stParam = MVCC_INTVALUE()</div><div class="line">memset(byref(stParam), 0, sizeof(stParam))</div><div class="line"></div><div class="line">ret = cam.MV_CC_GetIntValue(<span class="stringliteral">&quot;PayloadSize&quot;</span>, stParam)</div><div class="line"><span class="keywordflow">if</span> 0 != ret:</div><div class="line">    print(<span class="stringliteral">&quot;Get PayloadSize fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    <span class="keywordflow">return</span> ret</div><div class="line">nPayloadSize = stParam.nCurValue</div><div class="line">stDecodeParam.pSrcBuf = frame_info.pBufAddr</div><div class="line">stDecodeParam.nSrcLen = frame_info.stFrameInfo.nFrameLen</div><div class="line">stDecodeParam.pDstBuf = (c_ubyte * nPayloadSize)()</div><div class="line">stDecodeParam.nDstBufSize = nPayloadSize</div><div class="line">ret = cam.MV_CC_HBDecode(stDecodeParam)</div><div class="line"><span class="keywordflow">if</span> ret != 0:</div><div class="line">    print(<span class="stringliteral">&quot;HB Decode fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    <span class="keywordflow">return</span> ret</div></div><!-- fragment --> </div><p> <br />
 </div> <div id="record"> <div class="mainparams"> <h2>录像</h2>
</div></div></div><div><div id="record"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="record"><div class="subparamswhite">您可通过SDK将从相机接收到的图像保存成录像文件，其方法如下：</div></div></div><div><div id="record"><div class="subparamswhite"> <ol>
<li>
调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga973f9b444e4d098c42f838b045c22dda" title="开始录像">MV_CC_StartRecord()</a> ，开始录像，您需要配置录像的各种参数。 </li>
<li>
调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga73a62aeda05913907a6836ac11bcc0ba" title="输入录像数据">MV_CC_InputOneFrame()</a> ，循环放入图像数据。 </li>
<li>
在完成录像时，调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga74b00d1812b07ae7f776bce594066fb4" title="停止录像">MV_CC_StopRecord()</a> ，停止录像。 </li>
</ol>
</div></div></div><div><div id="record"><div class="subparamswhite">如下示例代码演示了如何将图像保存成录像文件。</div></div></div><div><div id="record"><div class="subparamswhite"> <ol>
<li>
<p class="startli"></p>
<p class="interli">开始录像：调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga973f9b444e4d098c42f838b045c22dda" title="开始录像">MV_CC_StartRecord()</a> 配置录像的参数，需要的参数可以从相机中获取，也可以从图像中获取。以下代码演示了从相机中获取宽、高、像素格式等参数。</p>
<div class="fragment"><div class="line">stParam =  MVCC_INTVALUE()</div><div class="line">memset(byref(stParam), 0, sizeof(MVCC_INTVALUE))</div><div class="line">stRecordPar = MV_CC_RECORD_PARAM()</div><div class="line">memset(byref(stRecordPar), 0, sizeof(MV_CC_RECORD_PARAM))</div><div class="line"><span class="comment"># ch:获取图像宽度 | en:Get the width of the image</span></div><div class="line">ret = cam.MV_CC_GetIntValue(<span class="stringliteral">&quot;Width&quot;</span>, stParam)</div><div class="line"><span class="keywordflow">if</span> ret != 0: </div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;get width fail! nRet [0x%x]&quot;</span> % ret)</div><div class="line">    sys.exit()</div><div class="line">stRecordPar.nWidth = stParam.nCurValue</div><div class="line"></div><div class="line"><span class="comment"># ch:获取图像高度 | en:Get the height of the image</span></div><div class="line">ret = cam.MV_CC_GetIntValue(<span class="stringliteral">&quot;Height&quot;</span>, stParam)</div><div class="line"><span class="keywordflow">if</span> ret != 0: </div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;get height fail! nRet [0x%x]&quot;</span>% ret)</div><div class="line">    sys.exit()</div><div class="line">stRecordPar.nHeight = stParam.nCurValue</div><div class="line"></div><div class="line"><span class="comment"># ch:获取图像像素 | en:Get the pixelFormat of the image</span></div><div class="line">stEnumValue = MVCC_ENUMVALUE()</div><div class="line">memset(byref(stEnumValue), 0 ,sizeof(MVCC_ENUMVALUE))</div><div class="line">ret = cam.MV_CC_GetEnumValue(<span class="stringliteral">&quot;PixelFormat&quot;</span>, stEnumValue)</div><div class="line"><span class="keywordflow">if</span> ret != 0: </div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;get PixelFormat fail! nRet [0x%x]&quot;</span> % ret)</div><div class="line">    sys.exit()</div><div class="line">stRecordPar.enPixelType = MvGvspPixelType(stEnumValue.nCurValue)</div><div class="line"></div><div class="line"><span class="comment"># ch:获取图像帧率 | en:Get the resultingFrameRate of the image</span></div><div class="line">stFloatValue = MVCC_FLOATVALUE()</div><div class="line">memset(byref(stFloatValue), 0 ,sizeof(MVCC_FLOATVALUE))</div><div class="line">ret = cam.MV_CC_GetFloatValue(<span class="stringliteral">&quot;ResultingFrameRate&quot;</span>, stFloatValue)</div><div class="line"><span class="keywordflow">if</span> ret != 0: </div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;get ResultingFrameRate value fail! nRet [0x%x]&quot;</span> % ret)</div><div class="line">    sys.exit()</div><div class="line">stRecordPar.fFrameRate = stFloatValue.fCurValue</div><div class="line"></div><div class="line"><span class="comment"># ch:录像结构体赋值 | en:Video structure assignment</span></div><div class="line">stRecordPar.nBitRate = 1000</div><div class="line">stRecordPar.enRecordFmtType = MV_FormatType_AVI</div><div class="line">stRecordPar.strFilePath= <span class="stringliteral">&#39;Recording.avi&#39;</span>.encode(<span class="stringliteral">&#39;ascii&#39;</span>)</div><div class="line"></div><div class="line"><span class="comment"># ch:开始录像 | en:Start Recording</span></div><div class="line">nRet = cam.MV_CC_StartRecord(stRecordPar)</div><div class="line"><span class="keywordflow">if</span> ret != 0: </div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;Start Record fail! nRet [0x%x]\n&quot;</span>, nRet)</div><div class="line">    sys.exit()</div></div><!-- fragment -->  </li>
<li>
<p class="startli"></p>
<p class="interli">放入图像到录像中：循环调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga73a62aeda05913907a6836ac11bcc0ba" title="输入录像数据">MV_CC_InputOneFrame()</a>，将从相机获取的图像数据放入录像中。</p>
<div class="fragment"><div class="line"><span class="comment"># 为线程定义一个函数</span></div><div class="line"><span class="keyword">def </span><a class="code" href="namespace_connect_spec_camera.html#a7d6fa85fa33561934776205cf7d83b26">work_thread</a>(cam=0, pData=0, nDataSize=0):</div><div class="line">    stOutFrame = MV_FRAME_OUT()  </div><div class="line">    memset(byref(stOutFrame), 0, sizeof(stOutFrame))</div><div class="line"></div><div class="line">    stInputFrameInfo = MV_CC_INPUT_FRAME_INFO()</div><div class="line">    memset(byref(stInputFrameInfo), 0 ,sizeof(MV_CC_INPUT_FRAME_INFO))</div><div class="line">    <span class="keywordflow">while</span> <span class="keyword">True</span>:</div><div class="line">        ret = cam.MV_CC_GetImageBuffer(stOutFrame, 1000)</div><div class="line">        <span class="keywordflow">if</span> <span class="keywordtype">None</span> != stOutFrame.pBufAddr <span class="keywordflow">and</span> 0 == ret:</div><div class="line">            <span class="keywordflow">print</span> (<span class="stringliteral">&quot;get one frame: Width[%d], Height[%d], nFrameNum[%d]&quot;</span>  % (stOutFrame.stFrameInfo.nWidth, stOutFrame.stFrameInfo.nHeight, stOutFrame.stFrameInfo.nFrameNum))</div><div class="line">            stInputFrameInfo.pData = cast(stOutFrame.pBufAddr, POINTER(c_ubyte))</div><div class="line">            stInputFrameInfo.nDataLen = stOutFrame.stFrameInfo.nFrameLen</div><div class="line">            <span class="comment"># ch:输入一帧数据到录像接口 | en:Input a frame of data to the video interface</span></div><div class="line">            ret = cam.MV_CC_InputOneFrame(stInputFrameInfo)</div><div class="line">            <span class="keywordflow">if</span> ret != 0:</div><div class="line">                <span class="keywordflow">print</span> (<span class="stringliteral">&quot;input one frame fail! nRet [0x%x]&quot;</span> % ret)</div><div class="line">            nRet = cam.MV_CC_FreeImageBuffer(stOutFrame)</div><div class="line">        <span class="keywordflow">else</span>:</div><div class="line">            <span class="keywordflow">print</span> (<span class="stringliteral">&quot;no data[0x%x]&quot;</span> % ret)</div><div class="line">        <span class="keywordflow">if</span> g_bExit == <span class="keyword">True</span>:</div><div class="line">                <span class="keywordflow">break</span></div></div><!-- fragment -->  </li>
<li>
<p class="startli"></p>
<p class="interli">停止录像：调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga74b00d1812b07ae7f776bce594066fb4" title="停止录像">MV_CC_StopRecord()</a> ，停止录像。</p>
<div class="fragment"><div class="line"><span class="comment"># ch:停止录像 | en:Stop recording</span></div><div class="line">ret = cam.MV_CC_StopRecord()</div><div class="line"><span class="keywordflow">if</span> ret != 0:</div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;stop Record fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    sys.exit()</div></div><!-- fragment -->  </li>
</ol>
</div><p> <br />
 </div> <div id="reconstruct"> <div class="mainparams"> <h2>分时曝光拆图</h2>
</div></div></div><div><div id="reconstruct"><div class="mainparams"> </div> <div class="subparamswhite"> <div> <b>SDK拆图</b> </div></div></div></div><div><div id="reconstruct"><div class="subparamswhite"><div>部分相机支持分时曝光功能，并将分时曝光的整图发送给SDK，应用程序可以调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#gad9aa4cee88e517847211ab01427f7a25" title="重构图像（用于分时曝光功能）">MV_CC_ReconstructImage()</a> ，拆分分时曝光的整图，输出每个曝光的图像。</div></div></div></div><div><div id="reconstruct"><div class="subparamswhite"><div> </div></div></div></div><div><div id="reconstruct"><div class="subparamswhite"><div>通过SDK端进行分时曝光拆图和图像重构的基本步骤如下：</div></div></div></div><div><div id="reconstruct"><div class="subparamswhite"><div> <ol>
<li>
调用 <a class="el" href="group___xE8_xAE_xBE_xE5_xA4_x87_xE5_xB1_x9E_xE6_x80_xA7.html#gaf90e3d0f751c6b7ec5796715a9cb5326" title="获取Enum属性值">MV_CC_GetEnumValue()</a> 获取“MultiLightControl”节点的值，即当前相机的多重曝光数量。 <dl class="section attention"><dt>注意</dt><dd><ul>
<li>
部分相机可能没有“MultiLightControl”节点，此时，您需根据实际曝光数量进行设置。 </li>
<li>
相机配置HB（High Bandwidth）模式下“MultiLightControl”节点的值，需要进行转换才能得到有效的曝光数量。 </li>
</ul>
</dd></dl>
</li>
<li>
若获取的图像为HB图像，调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#gaf610ed1745d1d26cdd8123e7759bebba" title="无损解码">MV_CC_HBDecode()</a> ，进行HB解码。 </li>
<li>
调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#gad9aa4cee88e517847211ab01427f7a25" title="重构图像（用于分时曝光功能）">MV_CC_ReconstructImage()</a> ，重构图像。 </li>
</ol>
</div></div></div></div><div><div id="reconstruct"><div class="subparamswhite"><div>示例代码如下：</div></div></div></div><div><div id="reconstruct"><div class="subparamswhite"><div> <div class="fragment"><div class="line"><span class="comment"># ch:重构参数 | en: reconstruct image parameters</span></div><div class="line">stReconstructParam = MV_RECONSTRUCT_IMAGE_PARAM()</div><div class="line"></div><div class="line"><span class="comment"># ch:如果图像是HB格式，需要先解码 | en:If the image is HB format, should to be decoded first</span></div><div class="line"><span class="keywordflow">if</span> stOutFrame.stFrameInfo.enPixelType <span class="keywordflow">in</span> HB_format_list:</div><div class="line">    <span class="comment"># 获取数据包大小</span></div><div class="line">    stParam = MVCC_INTVALUE()</div><div class="line">    memset(byref(stParam), 0, sizeof(stParam))</div><div class="line">    ret = cam.MV_CC_GetIntValue(<span class="stringliteral">&quot;PayloadSize&quot;</span>, stParam)</div><div class="line">    <span class="keywordflow">if</span> 0 != ret:</div><div class="line">        <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;Get PayloadSize fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    nPayloadSize = stParam.nCurValue</div><div class="line">    stDecodeParam.pSrcBuf = stOutFrame.pBufAddr</div><div class="line">    stDecodeParam.nSrcLen = stOutFrame.stFrameInfo.nFrameLen</div><div class="line">    stDecodeParam.pDstBuf = (c_ubyte * nPayloadSize)()</div><div class="line">    stDecodeParam.nDstBufSize = nPayloadSize</div><div class="line">    ret = cam.MV_CC_HBDecode(stDecodeParam)</div><div class="line">    <span class="keywordflow">if</span> ret != 0:</div><div class="line">        <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;HB Decode fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    <span class="keywordflow">else</span>:</div><div class="line">        stReconstructParam.nWidth = stDecodeParam.nWidth</div><div class="line">        stReconstructParam.nHeight = stDecodeParam.nHeight</div><div class="line">        stReconstructParam.enPixelType = stDecodeParam.enDstPixelType</div><div class="line">        stReconstructParam.pSrcData = stDecodeParam.pDstBuf</div><div class="line">        stReconstructParam.nSrcDataLen = stDecodeParam.nDstBufLen</div><div class="line"><span class="keywordflow">else</span>:</div><div class="line">    stReconstructParam.nWidth = stOutFrame.stFrameInfo.nWidth</div><div class="line">    stReconstructParam.nHeight = stOutFrame.stFrameInfo.nHeight</div><div class="line">    stReconstructParam.enPixelType = stOutFrame.stFrameInfo.enPixelType</div><div class="line">    stReconstructParam.pSrcData = stOutFrame.pBufAddr</div><div class="line">    stReconstructParam.nSrcDataLen = stOutFrame.stFrameInfo.nFrameLen</div><div class="line"></div><div class="line">stReconstructParam.nExposureNum = exposure_num</div><div class="line">stReconstructParam.enReconstructMethod = MV_SPLIT_BY_LINE</div><div class="line"></div><div class="line">dst_buffer_len = int(stReconstructParam.nSrcDataLen/exposure_num)</div><div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(exposure_num):</div><div class="line">    dst_buffer = (c_ubyte * dst_buffer_len)()</div><div class="line">    dst_buffer_list.append(dst_buffer)</div><div class="line">    stReconstructParam.stDstBufList[i].pBuf = dst_buffer_list[i]</div><div class="line">    stReconstructParam.stDstBufList[i].nBufSize = dst_buffer_len</div><div class="line"></div><div class="line"><span class="comment"># ch:图像重构 | en:Image Reconstruct</span></div><div class="line">ret = cam.MV_CC_ReconstructImage(stReconstructParam)</div><div class="line"><span class="keywordflow">if</span> ret != 0:</div><div class="line">    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;MV_CC_ReconstructImage fail! ret[0x%x]&quot;</span> % ret)</div><div class="line"><span class="keywordflow">else</span>:</div><div class="line">    print(<span class="stringliteral">&quot;Reconstruct image success&quot;</span>)</div></div><!-- fragment --> </div> </div> </div> <div> <br />
 <br />
 <br />
 <table width="60%">
<tr>
<td>上一篇： <a class="el" href="_xE9_x87_x87_xE9_x9B_x86_xE5_x9B_xBE_xE5_x83_x8F.html">采集图像</a> </td><td>下一篇：无  </td></tr>
</table>
</div> </div> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<div class="footer" style="text-align: right;">
	<hr/>
	<small></small>
</div>
</body>
</html>