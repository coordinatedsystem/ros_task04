<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="custom-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
	<div style="overflow: hidden;">
		<div style="height: 57px;min-width: 1039px;background-size: auto 100%;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABwgAAAABCAYAAADKO/rAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABRSURBVFhH7dUxCoBADEXB5LK5/w1iIaLIrsgWNs50Sf/4WVUd8HOZGd1nCqMbGNMPrNMPrJv1cvz0A3OjfuwPvDPrxf7A7t7IlX7gmX74VsQGguw4S6+UnSYAAAAASUVORK5CYII=');">
			<img src="titleleft.png" style="float: left;"/>
			<img src="titleright.png" alt="" style="float: right;" />
		</div>
	</div>
<!-- Generated by Doxygen 1.8.15 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home&#160;Page</span></a></li>
      <li><a href="_xE5_x8F_x91_xE7_x89_x88_xE8_xAF_xB4_xE6_x98_x8E.html"><span>Release&#160;Notes</span></a></li>
      <li><a href="usergroup0.html"><span>Programming&#160;Guide</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="_xE7_xA4_xBA_xE4_xBE_x8B_xE7_xA8_x8B_xE5_xBA_x8F_xE6_xA6_x82_xE8_xA7_x88.html"><span>Samples</span></a></li>
      <li><a href="_xE6_xB3_x95_xE5_xBE_x8B_xE5_xA3_xB0_xE6_x98_x8E.html"><span>Disclaimer</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Grab_Callback.cs</div>  </div>
</div><!--header-->
<div class="contents">
<p>Get Image(s) via Callback</p>
<p>It shows how to get images via callback (FrameGrabedEvent). In this way, the image grabbing thread will start inside the SDK, and will call back images acquired by camera to your application via event. <br />
 You can get the sample from the General folder in the sample program folder.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * It shows how to get images via callback (FrameGrabedEvent). In this way, the image grabbing thread will start inside the SDK, and will call back images via event.</span></div><div class="line"><span class="comment"> * This program shows how to grab images using event-driven method. The SDK starts a thread to grab images and uses the FrameGrabedEvent to return the images.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> System;</div><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div><div class="line"><span class="keyword">using</span> System.Linq;</div><div class="line"><span class="keyword">using</span> System.Text;</div><div class="line"><span class="keyword">using</span> MvCameraControl;</div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_grab___callback.html">Grab_Callback</a></div><div class="line">{</div><div class="line">    <span class="keyword">class </span><a class="code" href="namespace_grab___callback.html">Grab_Callback</a></div><div class="line">    {</div><div class="line">        <span class="keyword">const</span> <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a> devLayerType = <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a>.MvGigEDevice | <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a>.MvUsbDevice | <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a>.MvGenTLCameraLinkDevice</div><div class="line">            | <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a>.MvGenTLCXPDevice | <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a>.MvGenTLXoFDevice;</div><div class="line"></div><div class="line">        <span class="keyword">static</span> <span class="keywordtype">void</span> FrameGrabedEventHandler(<span class="keywordtype">object</span> sender, <a name="_a0"></a><a class="code" href="class_frame_grabbed_event_args.html">FrameGrabbedEventArgs</a> e)</div><div class="line">        {</div><div class="line">            Console.WriteLine(<span class="stringliteral">&quot;Get one frame: Width[{0}] , Height[{1}] , ImageSize[{2}], FrameNum[{3}]&quot;</span>, e.<a name="a1"></a><a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.<a name="a2"></a><a class="code" href="interface_i_frame_out.html#a926a2f7f8a8df31b3529d8a6b4e9cf1a">Image</a>.<a name="a3"></a><a class="code" href="interface_i_image.html#ad1d4412942ac2ef39b05340ee4b9fac8">Width</a>, e.<a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.<a class="code" href="interface_i_frame_out.html#a926a2f7f8a8df31b3529d8a6b4e9cf1a">Image</a>.<a name="a4"></a><a class="code" href="interface_i_image.html#af5b00bd33a696aa1637d4f6fe50722b5">Height</a>, e.<a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.<a class="code" href="interface_i_frame_out.html#a926a2f7f8a8df31b3529d8a6b4e9cf1a">Image</a>.<a name="a5"></a><a class="code" href="interface_i_image.html#ad2e018f7ed1a749484e5c618fcbfc55a">ImageSize</a>, e.<a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.<a name="a6"></a><a class="code" href="interface_i_frame_out.html#ace9e98635eaaf4d8e4f5a5b42496263c">FrameNum</a>);</div><div class="line"></div><div class="line">            <span class="comment">// Release image buffer manually</span></div><div class="line">            e.<a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.Dispose();</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">static</span> <span class="keywordtype">void</span> Main(<span class="keywordtype">string</span>[] args)</div><div class="line">        {</div><div class="line">            <span class="comment">// Initialize SDK resources</span></div><div class="line">            <a name="_a7"></a><a class="code" href="class_s_d_k_system.html">SDKSystem</a>.<a name="a8"></a><a class="code" href="class_s_d_k_system.html#a7013f5c07ae783a105f910ecb2c7b800">Initialize</a>();</div><div class="line"></div><div class="line">            <a name="_a9"></a><a class="code" href="interface_i_device.html">IDevice</a> device = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">           <span class="keywordflow">try</span></div><div class="line">           {</div><div class="line">               List&lt;IDeviceInfo&gt; devInfoList;</div><div class="line"></div><div class="line">               <span class="comment">// Enumerate devices</span></div><div class="line">               <span class="keywordtype">int</span> ret = <a name="_a10"></a><a class="code" href="class_device_enumerator.html">DeviceEnumerator</a>.<a name="a11"></a><a class="code" href="class_device_enumerator.html#acb8d0cafef88484de132e372a0305e7d">EnumDevices</a>(devLayerType, out devInfoList);</div><div class="line">               <span class="keywordflow">if</span> (ret != <a name="_a12"></a><a class="code" href="class_mv_error.html">MvError</a>.<a name="a13"></a><a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">               {</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;Enum device failed:{0:x8}&quot;</span>, ret);</div><div class="line">                   <span class="keywordflow">return</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               Console.WriteLine(<span class="stringliteral">&quot;Enum device count : {0}&quot;</span>, devInfoList.Count);</div><div class="line"></div><div class="line">               <span class="keywordflow">if</span> (0 == devInfoList.Count)</div><div class="line">               {</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;No device!&quot;</span>);</div><div class="line">                   <span class="keywordflow">return</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               <span class="comment">// Print device information</span></div><div class="line">               <span class="keywordtype">int</span> devIndex = 0;</div><div class="line">               <span class="keywordflow">foreach</span> (var devInfo <span class="keywordflow">in</span> devInfoList)</div><div class="line">               {</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;[Device {0}]:&quot;</span>, devIndex);</div><div class="line">                   <span class="keywordflow">if</span> (devInfo.TLayerType == <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a>.MvGigEDevice || devInfo.TLayerType == <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a>.MvVirGigEDevice || devInfo.TLayerType == <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA.html#ga0dc9b1d0b3ce8e4c07cbce297950db5c">DeviceTLayerType</a>.MvGenTLGigEDevice)</div><div class="line">                   {</div><div class="line">                       <a name="_a14"></a><a class="code" href="interface_i_gig_e_device_info.html">IGigEDeviceInfo</a> gigeDevInfo = devInfo as <a class="code" href="interface_i_gig_e_device_info.html">IGigEDeviceInfo</a>;</div><div class="line">                       uint nIp1 = ((gigeDevInfo.<a name="a15"></a><a class="code" href="interface_i_gig_e_device_info.html#af9f3924f7531627e32f56ef3fb88c539">CurrentIp</a> &amp; 0xff000000) &gt;&gt; 24);</div><div class="line">                       uint nIp2 = ((gigeDevInfo.<a class="code" href="interface_i_gig_e_device_info.html#af9f3924f7531627e32f56ef3fb88c539">CurrentIp</a> &amp; 0x00ff0000) &gt;&gt; 16);</div><div class="line">                       uint nIp3 = ((gigeDevInfo.<a class="code" href="interface_i_gig_e_device_info.html#af9f3924f7531627e32f56ef3fb88c539">CurrentIp</a> &amp; 0x0000ff00) &gt;&gt; 8);</div><div class="line">                       uint nIp4 = (gigeDevInfo.<a class="code" href="interface_i_gig_e_device_info.html#af9f3924f7531627e32f56ef3fb88c539">CurrentIp</a> &amp; 0x000000ff);</div><div class="line">                       Console.WriteLine(<span class="stringliteral">&quot;DevIP: {0}.{1}.{2}.{3}&quot;</span>, nIp1, nIp2, nIp3, nIp4);</div><div class="line">                   }</div><div class="line"></div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;ModelName:&quot;</span> + devInfo.ModelName);</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;SerialNumber:&quot;</span> + devInfo.SerialNumber);</div><div class="line">                   Console.WriteLine();</div><div class="line">                   devIndex++;</div><div class="line">               }</div><div class="line"></div><div class="line">               Console.Write(<span class="stringliteral">&quot;Please input index(0-{0:d}):&quot;</span>, devInfoList.Count - 1);</div><div class="line"></div><div class="line">               devIndex = Convert.ToInt32(Console.ReadLine());</div><div class="line"></div><div class="line">               <span class="keywordflow">if</span> (devIndex &gt; devInfoList.Count - 1 || devIndex &lt; 0)</div><div class="line">               {</div><div class="line">                   Console.Write(<span class="stringliteral">&quot;Input Error!\n&quot;</span>);</div><div class="line">                   <span class="keywordflow">return</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               <span class="comment">// Create the device</span></div><div class="line">               device = <a name="_a16"></a><a class="code" href="class_device_factory.html">DeviceFactory</a>.<a name="a17"></a><a class="code" href="class_device_factory.html#a19ad2c419b04a772be6cc852467b1b68">CreateDevice</a>(devInfoList[devIndex]);</div><div class="line"></div><div class="line">               ret = device.<a name="a18"></a><a class="code" href="interface_i_device.html#a3d7c509521042ad1ed2addced19d0304">Open</a>();</div><div class="line">               <span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">               {</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;Open device failed:{0:x8}&quot;</span>, ret);</div><div class="line">                   <span class="keywordflow">return</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               <span class="comment">// Get optimal packet size (only supported by GigE devices)</span></div><div class="line">               <span class="keywordflow">if</span> (device is <a name="_a19"></a><a class="code" href="interface_i_gig_e_device.html">IGigEDevice</a>)</div><div class="line">               {</div><div class="line">                   <span class="keywordtype">int</span> packetSize;</div><div class="line">                   ret = (device as <a class="code" href="interface_i_gig_e_device.html">IGigEDevice</a>).GetOptimalPacketSize(out packetSize);</div><div class="line">                   <span class="keywordflow">if</span> (packetSize &gt; 0)</div><div class="line">                   {</div><div class="line">                       ret = device.<a name="a20"></a><a class="code" href="interface_i_device.html#ac6c5038b94b5d23b5c85d824b69f13bf">Parameters</a>.<a name="a21"></a><a class="code" href="interface_i_parameters.html#ad0868d9048824c82a2676e193d97094b">SetIntValue</a>(<span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, packetSize);</div><div class="line">                       <span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">                       {</div><div class="line">                           Console.WriteLine(<span class="stringliteral">&quot;Warning: Set Packet Size failed {0:x8}&quot;</span>, ret);</div><div class="line">                       }</div><div class="line">                       <span class="keywordflow">else</span></div><div class="line">                       {</div><div class="line">                           Console.WriteLine(<span class="stringliteral">&quot;Set PacketSize to {0}&quot;</span>, packetSize);</div><div class="line">                       }</div><div class="line">                   }</div><div class="line">                   <span class="keywordflow">else</span></div><div class="line">                   {</div><div class="line">                       Console.WriteLine(<span class="stringliteral">&quot;Warning: Get Packet Size failed {0:x8}&quot;</span>, ret);</div><div class="line">                   }</div><div class="line">               }</div><div class="line"></div><div class="line">               <span class="comment">// Set trigger mode to off</span></div><div class="line">               ret = device.<a class="code" href="interface_i_device.html#ac6c5038b94b5d23b5c85d824b69f13bf">Parameters</a>.<a name="a22"></a><a class="code" href="interface_i_parameters.html#a91df86e0d55c43b7efb4f79c4d2909a1">SetEnumValue</a>(<span class="stringliteral">&quot;TriggerMode&quot;</span>, 0);</div><div class="line">               <span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">               {</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;Set TriggerMode failed:{0:x8}&quot;</span>, ret);</div><div class="line">                   <span class="keywordflow">return</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               <span class="comment">// Set an appropriate number of buffer nodes</span></div><div class="line">               device.<a name="a23"></a><a class="code" href="interface_i_device.html#a5491d0e3ad3479b873e0d7878386c4cb">StreamGrabber</a>.<a name="a24"></a><a class="code" href="interface_i_stream_grabber.html#a34f0db3e83dd83661f500b305c7bdf93">SetImageNodeNum</a>(5);</div><div class="line"></div><div class="line">               <span class="comment">// Register a callback</span></div><div class="line">               device.<a class="code" href="interface_i_device.html#a5491d0e3ad3479b873e0d7878386c4cb">StreamGrabber</a>.<a name="a25"></a><a class="code" href="interface_i_stream_grabber.html#a17cbeebabf4481f5c0106a9a3b2ca2e7">FrameGrabedEventEx</a> += FrameGrabedEventHandler;</div><div class="line">               <span class="comment">// Start grabbing images</span></div><div class="line">               ret = device.<a class="code" href="interface_i_device.html#a5491d0e3ad3479b873e0d7878386c4cb">StreamGrabber</a>.<a name="a26"></a><a class="code" href="interface_i_stream_grabber.html#a3a77e754ee97eea5dc9b453aa2294cb1">StartGrabbing</a>();</div><div class="line">               <span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">               {</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;Start grabbing failed:{0:x8}&quot;</span>, ret);</div><div class="line">                   <span class="keywordflow">return</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               Console.WriteLine(<span class="stringliteral">&quot;Press enter to exit&quot;</span>);</div><div class="line">               Console.ReadLine();</div><div class="line"></div><div class="line"></div><div class="line">               <span class="comment">// Stop grabbing images</span></div><div class="line">               ret = device.<a class="code" href="interface_i_device.html#a5491d0e3ad3479b873e0d7878386c4cb">StreamGrabber</a>.<a name="a27"></a><a class="code" href="interface_i_stream_grabber.html#a721412beb921ad084d72c24c5763f5a5">StopGrabbing</a>();</div><div class="line">               <span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">               {</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;Stop grabbing failed:{0:x8}&quot;</span>, ret);</div><div class="line">                   <span class="keywordflow">return</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               <span class="comment">// Turn off the device</span></div><div class="line">               ret = device.<a name="a28"></a><a class="code" href="interface_i_device.html#adb72189b679fc15d5055763918547999">Close</a>();</div><div class="line">               <span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">               {</div><div class="line">                   Console.WriteLine(<span class="stringliteral">&quot;Close device failed:{0:x8}&quot;</span>, ret);</div><div class="line">                   <span class="keywordflow">return</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               <span class="comment">// Destroy the device</span></div><div class="line">               device.Dispose();</div><div class="line">               device = <span class="keyword">null</span>;</div><div class="line">           }</div><div class="line">            <span class="keywordflow">catch</span>(Exception e)</div><div class="line">           {</div><div class="line">               Console.Write(<span class="stringliteral">&quot;Exception: &quot;</span> + e.Message);</div><div class="line">           }</div><div class="line">            <span class="keywordflow">finally</span></div><div class="line">           {</div><div class="line">               <span class="comment">// Destroy the device</span></div><div class="line">               <span class="keywordflow">if</span> (device != <span class="keyword">null</span>)</div><div class="line">               {</div><div class="line">                   device.Dispose();</div><div class="line">                   device = <span class="keyword">null</span>;</div><div class="line">               }</div><div class="line"></div><div class="line">               <span class="comment">// Release SDK resources</span></div><div class="line">               <a class="code" href="class_s_d_k_system.html">SDKSystem</a>.<a name="a29"></a><a class="code" href="class_s_d_k_system.html#aa54962a71ad911c8fb67f7d395049e19">Finalize</a>();</div><div class="line"></div><div class="line">               Console.WriteLine(<span class="stringliteral">&quot;Press enter to exit&quot;</span>);</div><div class="line">               Console.ReadKey();</div><div class="line">           }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<div class="footer" style="text-align: right;">
	<hr/>
	<small></small>
</div>
</body>
</html>