<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="custom-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
	<div style="overflow: hidden;">
		<div style="height: 57px;min-width: 1039px;background-size: auto 100%;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABwgAAAABCAYAAADKO/rAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABRSURBVFhH7dUxCoBADEXB5LK5/w1iIaLIrsgWNs50Sf/4WVUd8HOZGd1nCqMbGNMPrNMPrJv1cvz0A3OjfuwPvDPrxf7A7t7IlX7gmX74VsQGguw4S6+UnSYAAAAASUVORK5CYII=');">
			<img src="titleleft.png" style="float: left;"/>
			<img src="titleright.png" alt="" style="float: right;" />
		</div>
	</div>
<!-- 制作者 Doxygen 1.8.15 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>首页</span></a></li>
      <li><a href="_xE5_x8F_x91_xE7_x89_x88_xE8_xAF_xB4_xE6_x98_x8E.html"><span>发版说明</span></a></li>
      <li><a href="_xE7_x8E_xAF_xE5_xA2_x83_xE9_x85_x8D_xE7_xBD_xAE.html"><span>环境配置</span></a></li>
      <li><a href="_xE7_xBC_x96_xE7_xA8_x8B_xE5_xBC_x95_xE5_xAF_xBC.html"><span>编程引导</span></a></li>
      <li><a href="modules.html"><span>API参考</span></a></li>
      <li><a href="_xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE8_x8A_x82_xE7_x82_xB9_xE8_xA1_xA8.html"><span>相机参数节点表</span></a></li>
      <li><a href="_xE7_xA4_xBA_xE4_xBE_x8B_xE7_xA8_x8B_xE5_xBA_x8F_xE6_xA6_x82_xE8_xA7_x88.html"><span>示例程序概览</span></a></li>
      <li><a href="_xE5_xB8_xB8_xE8_xA7_x81_xE9_x97_xAE_xE9_xA2_x98.html"><span>常见问题</span></a></li>
      <li><a href="_xE6_xB3_x95_xE5_xBE_x8B_xE5_xA3_xB0_xE6_x98_x8E.html"><span>法律声明</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="PageDoc"><div class="contents">
<div class="textblock"><div class="header" style="margin-left:-12px;margin-top:-10px;margin-right:-8px;"> <div class="headertitle"> <div class="title">事件及异常</div> </div> </div> <p>事件可分为正常通知事件和异常告警事件。</p>
<ul>
<li>
<p class="startli"></p>
<p class="interli">正常通知事件指相机或采集卡处于正常状态下出现的事件。根据事件生成条件的差异，让设备上报事件至您的程序的操作有所差异。</p>
<ul>
<li>
<p class="startli"></p>
<p class="interli">部分事件需在相机或连接至采集卡的相机开始取流后才可触发。对于此类事件，您在程序中调用事件相关接口订阅并启用指定事件后，需调用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga78728211c47c6f118110fde635d6ac69" title="开始取流">MV_CC_StartGrabbing()</a> 让相机开始取流，从而让设备上报取流相关的事件至您的程序。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli">部分事件无需取流即可上报。您可调用事件相关接口订阅并启用指定事件，让设备上报事件至您的程序。</p>
<p class="endli"></p>
</li>
</ul>
</li>
<li>
<p class="startli"></p>
<p class="interli">异常告警事件是在相机、采集卡或者SDK运行时产生的异常事件（例如相机掉线等），此类事件可直接从SDK中获取，可用于及时预警，排除异常情况。 </p>
<p class="interli"></p>
<p class="interli">成功打开相机或采集卡后，您可注册自定义的异常告警事件处理函数。注册成功后，当设备产生异常告警时，程序将执行该自定义异常告警处理函数。</p>
<p class="endli"></p>
</li>
</ul>
<div> <div id="eventGrab"> <div class="mainparams"> <h2 id="事件采集">事件采集</h2>
</div></div></div><div><div id="eventGrab"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="eventGrab"><div class="subparamswhite">您可以依次通过订阅、启用、获取、关闭和取消订阅正常通知事件，完成事件的处理流程。</div></div></div><div><div id="eventGrab"><div class="subparamswhite"> <dl class="section note"><dt>注解</dt><dd>若要获取正常通知事件，需先通过客户端配置相机或采集卡。 <ul>
<li>
相机配置操作详情参见客户端用户手册。 </li>
<li>
采集卡事件可以通过采集卡事件配置工具进行配置。 </li>
</ul>
</dd></dl>
<ol>
<li>
<p class="startli"></p>
<p class="interli"><b>订阅</b>：可通过调用 <a class="el" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gacf91dadffe76819c9a10d2ec62077779" title="注册单个事件回调，在打开设备之后调用">MV_CC_RegisterEventCallBackEx()</a> 订阅指定事件。调用该接口时需传入事件名称strEventName。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli"><b>启用</b>：可通过调用 <a class="el" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#ga21ff79ee2297cbe0374464343d787f8f" title="开启设备指定事件">MV_CC_EventNotificationOn()</a> 启用指定事件。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli"><b>获取</b>：当相机或采集卡生成一个事件时，SDK会触发对应的事件回调函数并将该事件信息推送给用户。一般情况下，推送给用户的事件信息中包含事件名称、事件ID和时间戳等关键信息，其他信息如帧号和事件数据等则不一定包含。不同事件所包含的信息会存在差异，请以实际情况为准。</p>
<dl class="section attention"><dt>注意</dt><dd>请勿通过事件回调函数执行耗时较长的操作，否则将导致后续事件信息的推送被阻塞。</dd></dl>
</li>
<li>
<p class="startli"></p>
<p class="interli"><b>关闭</b>：可通过调用 <a class="el" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gab8cf38e9e3efa37339453c8c86c87e91" title="关闭设备指定事件">MV_CC_EventNotificationOff()</a> 关闭指定事件。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli"><b>取消订阅</b>：可通过调用 <a class="el" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gacf91dadffe76819c9a10d2ec62077779" title="注册单个事件回调，在打开设备之后调用">MV_CC_RegisterEventCallBackEx()</a> 取消订阅指定事件。调用该接口时需传入事件名称strEventName，并将事件回调指针cbEvent设置为NULL。调用成功后，则取消订阅指定事件。</p>
<p class="endli"></p>
</li>
</ol>
</div></div></div><div><div id="eventGrab"><div class="subparamswhite">如下示例代码演示了相机"曝光结束"事件的处理全过程。</div></div></div><div><div id="eventGrab"><div class="subparamswhite"> <div class="fragment"><div class="line"><span class="comment">//事件回调函数</span></div><div class="line"><span class="keywordtype">void</span> __stdcall <a class="code" href="_events___interface_8cpp.html#abe1e388b4a77bd647ef96db852929c7d">EventCallBack</a>(<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html">MV_EVENT_OUT_INFO</a> * pEventInfo, <span class="keywordtype">void</span>* pUser)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (pEventInfo)</div><div class="line">    {</div><div class="line">        __int64 nBlockId = pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a9df6b2cca06c4fd0a4812cc037f1639e">nBlockIdHigh</a>;</div><div class="line">        nBlockId = (nBlockId &lt;&lt; 32) + pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a41ad25f1ab6f18ccfbf98a6781f9f636">nBlockIdLow</a>;</div><div class="line">        __int64 nTimestamp = pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a49956ae9753c62a986aab9d5fe55c770">nTimestampHigh</a>;</div><div class="line">        nTimestamp = (nTimestamp &lt;&lt; 32) + pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a2afc62303be6a9adc2bb042bb944263d">nTimestampLow</a>;</div><div class="line">        </div><div class="line">        printf(<span class="stringliteral">&quot;EventName[%s], EventID[%u], BlockId[%I64d], Timestamp[%I64d]\n&quot;</span>, </div><div class="line">        pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a68c4512382aab7af7afead8077ce03cc">EventName</a>, pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#af2d4fb0624cf2c9879244dfa8ad2630e">nEventID</a>,nBlockId,nTimestamp);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordtype">int</span> <a class="code" href="_parametrize_camera___area_scan_i_o_settings_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> nRet = <a class="code" href="group___s_d_k_xE5_x86_x85_xE9_x83_xA8_xE8_x87_xAA_xE5_xAE_x9A_xE4_xB9_x89_xE7_x8A_xB6_xE6_x80_x81_xE7_xA0_x81.html#gacc4f15d534603b339f751d8b2d569305">MV_OK</a>;</div><div class="line">    </div><div class="line">    <span class="comment">//程序启动后初始化SDK</span></div><div class="line">    <a class="code" href="group___s_d_k_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga768544eb6e6435313dd99ee9cf92d59d">MV_CC_Initialize</a>() ;</div><div class="line">    </div><div class="line">    <span class="comment">//枚举设备，创建相机实例</span></div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">//打开相机</span></div><div class="line">    nRet = <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga308c9a9869be7a457d27aadd94ce57dd">MV_CC_OpenDevice</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//订阅相机曝光结束事件</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gacf91dadffe76819c9a10d2ec62077779">MV_CC_RegisterEventCallBackEx</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>, <span class="stringliteral">&quot;ExposureEnd&quot;</span>, <a class="code" href="_events___interface_8cpp.html#abe1e388b4a77bd647ef96db852929c7d">EventCallBack</a>, <a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//启用相机曝光结束事件</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#ga21ff79ee2297cbe0374464343d787f8f">MV_CC_EventNotificationOn</a> (<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>,<span class="stringliteral">&quot;ExposureEnd&quot;</span>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//开始取流</span></div><div class="line">    nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga78728211c47c6f118110fde635d6ac69">MV_CC_StartGrabbing</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">// 停止取流 </span></div><div class="line">    nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gae5d7f4ae46a53851f104e26fa449ab06">MV_CC_StopGrabbing</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//关闭相机曝光结束事件</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gab8cf38e9e3efa37339453c8c86c87e91">MV_CC_EventNotificationOff</a> (<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>,<span class="stringliteral">&quot;ExposureEnd&quot;</span>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//订阅相机曝光结束事件</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gacf91dadffe76819c9a10d2ec62077779">MV_CC_RegisterEventCallBackEx</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>, <span class="stringliteral">&quot;ExposureEnd&quot;</span>, NULL, <a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//关闭设备</span></div><div class="line">    nRet = <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga33853bd328f46492102246ca8b645d57">MV_CC_CloseDevice</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//销毁句柄</span></div><div class="line">    nRet = <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga0f74372a22e8a19fa7e21dad45070428">MV_CC_DestroyHandle</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//反初始化SDK</span></div><div class="line">    <a class="code" href="group___s_d_k_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#gafa1820a0da8671fc6f77dc9a7dfa69d3">MV_CC_Finalize</a>();</div><div class="line">    </div><div class="line">    <span class="keywordflow">return</span> nRet;</div><div class="line">}</div></div><!-- fragment --> <dl class="section note"><dt>注解</dt><dd>枚举设备和创建相机实例步骤的示例代码可参考<a class="el" href="_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE7_x9B_xB8_xE6_x9C_xBA.html">初始化相机</a> 章节。<br />
</dd></dl>
</div></div></div><div><div id="eventGrab"><div class="subparamswhite">如下示例代码演示了采集卡"帧开始"事件的处理全过程。</div></div></div><div><div id="eventGrab"><div class="subparamswhite"> <div class="fragment"><div class="line"><span class="comment">//事件回调函数</span></div><div class="line"><span class="keywordtype">void</span> __stdcall <a class="code" href="_events___interface_8cpp.html#abe1e388b4a77bd647ef96db852929c7d">EventCallBack</a>(<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html">MV_EVENT_OUT_INFO</a> * pEventInfo, <span class="keywordtype">void</span>* pUser)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (pEventInfo)</div><div class="line">    {</div><div class="line">        __int64 nBlockId = pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a9df6b2cca06c4fd0a4812cc037f1639e">nBlockIdHigh</a>;</div><div class="line">        nBlockId = (nBlockId &lt;&lt; 32) + pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a41ad25f1ab6f18ccfbf98a6781f9f636">nBlockIdLow</a>;</div><div class="line">        __int64 nTimestamp = pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a49956ae9753c62a986aab9d5fe55c770">nTimestampHigh</a>;</div><div class="line">        nTimestamp = (nTimestamp &lt;&lt; 32) + pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a2afc62303be6a9adc2bb042bb944263d">nTimestampLow</a>;</div><div class="line">        printf(<span class="stringliteral">&quot;EventName[%s], EventID[%u], BlockId[%I64d], Timestamp[%I64d]\n&quot;</span>, </div><div class="line">        pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#a68c4512382aab7af7afead8077ce03cc">EventName</a>, pEventInfo-&gt;<a class="code" href="struct_m_v___e_v_e_n_t___o_u_t___i_n_f_o.html#af2d4fb0624cf2c9879244dfa8ad2630e">nEventID</a>,nBlockId,nTimestamp);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordtype">int</span> <a class="code" href="_parametrize_camera___area_scan_i_o_settings_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> nRet = <a class="code" href="group___s_d_k_xE5_x86_x85_xE9_x83_xA8_xE8_x87_xAA_xE5_xAE_x9A_xE4_xB9_x89_xE7_x8A_xB6_xE6_x80_x81_xE7_xA0_x81.html#gacc4f15d534603b339f751d8b2d569305">MV_OK</a>;</div><div class="line">    <span class="comment">//程序启动后初始化SDK</span></div><div class="line">    <a class="code" href="group___s_d_k_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga768544eb6e6435313dd99ee9cf92d59d">MV_CC_Initialize</a>() ;</div><div class="line">    </div><div class="line">    <span class="comment">//枚举设备，创建采集卡实例</span></div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">//打开采集卡</span></div><div class="line">    nRet = <a class="code" href="group___xE9_x87_x87_xE9_x9B_x86_xE5_x8D_xA1_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#gac57264660ca9acb36a43c23adb2147a7">MV_CC_OpenInterface</a>(hInterface, NULL);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//订阅采集卡”帧开始”事件</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gacf91dadffe76819c9a10d2ec62077779">MV_CC_RegisterEventCallBackEx</a>(hInterface, <span class="stringliteral">&quot;FrameStart&quot;</span>, <a class="code" href="_events___interface_8cpp.html#abe1e388b4a77bd647ef96db852929c7d">EventCallBack</a>, hInterface);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//启用采集卡”帧开始”事件</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#ga21ff79ee2297cbe0374464343d787f8f">MV_CC_EventNotificationOn</a> (hInterface,<span class="stringliteral">&quot;ReceiveImageFrameStart0&quot;</span>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//进行其他处理 </span></div><div class="line">    </div><div class="line">    <span class="comment">//关闭采集卡”帧开始”事件</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gab8cf38e9e3efa37339453c8c86c87e91">MV_CC_EventNotificationOff</a> (hInterface,<span class="stringliteral">&quot;ReceiveImageFrameStart0&quot;</span>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//取消订阅 采集卡”帧开始”事件</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gacf91dadffe76819c9a10d2ec62077779">MV_CC_RegisterEventCallBackEx</a>(hInterface, <span class="stringliteral">&quot;FrameStart&quot;</span>, NULL, hInterface);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//关闭设备</span></div><div class="line">    nRet = <a class="code" href="group___xE9_x87_x87_xE9_x9B_x86_xE5_x8D_xA1_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga98f4a5025eebf615499a23da0b73970d">MV_CC_CloseInterface</a>(hInterface);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//销毁句柄</span></div><div class="line">    nRet = <a class="code" href="group___xE9_x87_x87_xE9_x9B_x86_xE5_x8D_xA1_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga365d684482405b74afe9d21b986185af">MV_CC_DestroyInterface</a>(hInterface);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//反初始化SDK</span></div><div class="line">    <a class="code" href="group___s_d_k_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#gafa1820a0da8671fc6f77dc9a7dfa69d3">MV_CC_Finalize</a>();</div><div class="line">    </div><div class="line">    <span class="keywordflow">return</span> nRet;</div><div class="line">}</div></div><!-- fragment --> <dl class="section note"><dt>注解</dt><dd>枚举设备和创建采集卡实例步骤的示例代码可参考<a class="el" href="_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE9_x87_x87_xE9_x9B_x86_xE5_x8D_xA1.html">初始化采集卡</a> 章节。<br />
  </dd></dl>
<div id="abnormal"> <div class="mainparams"> <h2 id="异常事件">异常事件</h2>
</div></div></div></div></div><div><div id="eventGrab"><div class="subparamswhite"><div id="abnormal"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div></div></div><div><div id="eventGrab"><div class="subparamswhite"><div id="abnormal"><div class="subparamswhite">异常告警事件可直接从SDK中获取。该类型事件的处理流程包括注册、获取和注销。</div></div></div></div></div><div><div id="eventGrab"><div class="subparamswhite"><div id="abnormal"><div class="subparamswhite"> <ol>
<li>
<p class="startli"></p>
<p class="interli"><b>注册</b>：通过函数 <a class="el" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gaf112628faf1181023a63b3cbed7df8eb" title="注册异常消息回调，在打开设备之后调用">MV_CC_RegisterExceptionCallBack()</a> 注册异常事件，若出现异常情况时，则异常会及时上报给SDK。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli"><b>获取</b>：当SDK出现异常时，会触发异常事件回调函数。该函数可将异常告警事件推送给用户。</p>
<dl class="section attention"><dt>注意</dt><dd>请勿通过异常事件回调函数执行耗时较长的操作，否则将导致后续事件信息的推送被阻塞。 </dd></dl>
</li>
<li>
<p class="startli"></p>
<p class="interli"><b>注销</b>：调用 <a class="el" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gaf112628faf1181023a63b3cbed7df8eb" title="注册异常消息回调，在打开设备之后调用">MV_CC_RegisterExceptionCallBack()</a> 注销异常告警事件。当异常回调函数为NULL时，可取消采集卡或相机实例的设备异常事件。</p>
<p class="interli"></p>
<p class="interli">如下示例代码演示了如何订阅、处理和取消订阅异常事件。</p>
<div class="fragment"><div class="line"><span class="comment">//异常事件回调函数</span></div><div class="line"><span class="keywordtype">void</span> __stdcall ExceptionCallBack(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nMsgType, <span class="keywordtype">void</span>* pUser)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span>(nMsgType == <a class="code" href="group___xE5_xAE_x8F_xE5_xAE_x9A_xE4_xB9_x89.html#gabc7a5d3d85a08c80642bd526db563aa4">MV_EXCEPTION_DEV_DISCONNECT</a>)</div><div class="line">    {</div><div class="line">        printf(<span class="stringliteral">&quot;ExceptionCallBack Recv Type[%d]\n&quot;</span>, nMsgType);</div><div class="line">        <span class="comment">//可以进行异常处理，比如关闭相机，销毁句柄，重新枚举相机，打开相机等;</span></div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordtype">int</span> <a class="code" href="_parametrize_camera___area_scan_i_o_settings_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> nRet = <a class="code" href="group___s_d_k_xE5_x86_x85_xE9_x83_xA8_xE8_x87_xAA_xE5_xAE_x9A_xE4_xB9_x89_xE7_x8A_xB6_xE6_x80_x81_xE7_xA0_x81.html#gacc4f15d534603b339f751d8b2d569305">MV_OK</a>;</div><div class="line">    <span class="comment">//程序启动后调用&quot;初始化SDK&quot;</span></div><div class="line">    <a class="code" href="group___s_d_k_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga768544eb6e6435313dd99ee9cf92d59d">MV_CC_Initialize</a>() ;</div><div class="line"></div><div class="line">        </div><div class="line">    <span class="comment">//枚举设备，创建实例</span></div><div class="line">    </div><div class="line"></div><div class="line">    <span class="comment">//打开相机</span></div><div class="line">    nRet = <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga308c9a9869be7a457d27aadd94ce57dd">MV_CC_OpenDevice</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//注册异常消息回调</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gaf112628faf1181023a63b3cbed7df8eb">MV_CC_RegisterExceptionCallBack</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>, ExceptionCallBack, <a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//开始取流 </span></div><div class="line">    nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga78728211c47c6f118110fde635d6ac69">MV_CC_StartGrabbing</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//停止取流</span></div><div class="line">    nRet = <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gae5d7f4ae46a53851f104e26fa449ab06">MV_CC_StopGrabbing</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//注销异常消息回调</span></div><div class="line">    nRet = <a class="code" href="group___xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html#gaf112628faf1181023a63b3cbed7df8eb">MV_CC_RegisterExceptionCallBack</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>, NULL, <a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//关闭设备</span></div><div class="line">    nRet = <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga33853bd328f46492102246ca8b645d57">MV_CC_CloseDevice</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//销毁句柄</span></div><div class="line">    nRet = <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#ga0f74372a22e8a19fa7e21dad45070428">MV_CC_DestroyHandle</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>);</div><div class="line">    Check(nRet);</div><div class="line">    </div><div class="line">    <span class="comment">//反初始化SDK</span></div><div class="line">    <a class="code" href="group___s_d_k_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96.html#gafa1820a0da8671fc6f77dc9a7dfa69d3">MV_CC_Finalize</a>();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> <dl class="section note"><dt>注解</dt><dd>枚举设备和创建实例步骤的示例代码参见<a class="el" href="_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE9_x87_x87_xE9_x9B_x86_xE5_x8D_xA1.html">初始化采集卡</a> 章节或<a class="el" href="_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE7_x9B_xB8_xE6_x9C_xBA.html">初始化相机</a> 章节。 </dd></dl>
</li>
</ol>
</div> </div></div></div></div><div><div id="eventGrab"><div class="subparamswhite"> <div id="cache"> <div class="mainparams"> <h2 id="事件缓存调节">事件缓存调节</h2>
</div></div></div></div></div><div><div id="eventGrab"><div class="subparamswhite"><div id="cache"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div></div></div><div><div id="eventGrab"><div class="subparamswhite"><div id="cache"><div class="subparamswhite">GigE相机产生的事件使用socket缓冲区，不需要额外配置缓存区，而U3V设备产生的事件通过事件端点或链路上报。在SDK内部，默认有5个缓存节点可以接收事件。若上层软件处理速度较慢或者设备上报事件的频率较高，则可能导致SDK内部缓存不足，导致丢事件的情况发生。此时，您可以通过 <a class="el" href="group___u3_v_xE7_x9B_xB8_xE6_x9C_xBA.html#ga54f98a479ef686d954022805d45af167" title="设置U3V的事件缓存节点个数">MV_USB_SetEventNodeNum()</a> 修改U3V相机SDK内部的事件缓存节点数量。</div></div></div></div></div><div><div id="eventGrab"><div class="subparamswhite"><div id="cache"><div class="subparamswhite"> <div class="fragment"><div class="line"><span class="comment">//调节SDK 内部U3V设备的Event事件缓存节点数量</span></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEventNodeNum = 5;</div><div class="line">nRet = <a class="code" href="group___u3_v_xE7_x9B_xB8_xE6_x9C_xBA.html#ga54f98a479ef686d954022805d45af167">MV_USB_SetEventNodeNum</a>(<a class="code" href="_image_save_8cpp.html#a81011b79683fab64ce3aff71114f8fdd">handle</a>, nEventNodeNum);</div><div class="line">Check(nRet);</div></div><!-- fragment --> </div> </div></div></div></div><div><div id="eventGrab"><div class="subparamswhite"> <div> <br />
 <br />
 <br />
 <table width="60%">
<tr>
<td>上一篇： <a class="el" href="_xE8_xAE_xBE_xE7_xBD_xAE_xE5_x8F_x82_xE6_x95_xB0.html">设置参数</a> </td><td>下一篇： <a class="el" href="_xE9_x87_x87_xE9_x9B_x86_xE5_x9B_xBE_xE5_x83_x8F.html">采集图像</a>  </td></tr>
</table>
</div> </div> </div></div></div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<div class="footer" style="text-align: right;">
	<hr/>
	<small></small>
</div>
<script>
	// 当前选中的菜单
	var currentMenuItem = document.querySelector('.tablist > li.current > a')
	if (currentMenuItem) { // 子菜单情况
	  window.parent.postMessage({
		navHref: currentMenuItem.href
	  }, '*')
	} else {
	  window.parent.postMessage({
		url: window.location.href
	  }, '*')
	}
  </script>
</body>
</html>