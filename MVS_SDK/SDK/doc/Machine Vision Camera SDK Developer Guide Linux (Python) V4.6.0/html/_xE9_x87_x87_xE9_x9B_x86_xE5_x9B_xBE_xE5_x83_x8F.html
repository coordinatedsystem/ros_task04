<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="custom-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
	<div style="overflow: hidden;">
		<div style="height: 57px;min-width: 1039px;background-size: auto 100%;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABwgAAAABCAYAAADKO/rAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABRSURBVFhH7dUxCoBADEXB5LK5/w1iIaLIrsgWNs50Sf/4WVUd8HOZGd1nCqMbGNMPrNMPrJv1cvz0A3OjfuwPvDPrxf7A7t7IlX7gmX74VsQGguw4S6+UnSYAAAAASUVORK5CYII=');">
			<img src="titleleft.png" style="float: left;"/>
			<img src="titleright.png" alt="" style="float: right;" />
		</div>
	</div>
<!-- Generated by Doxygen 1.8.15 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home&#160;Page</span></a></li>
      <li><a href="_xE5_x8F_x91_xE7_x89_x88_xE8_xAF_xB4_xE6_x98_x8E.html"><span>Release&#160;Notes</span></a></li>
      <li><a href="_xE7_xBC_x96_xE7_xA8_x8B_xE5_xBC_x95_xE5_xAF_xBC.html"><span>Programming&#160;Guide</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="_xE7_xA4_xBA_xE4_xBE_x8B_xE7_xA8_x8B_xE5_xBA_x8F_xE6_xA6_x82_xE8_xA7_x88.html"><span>Samples</span></a></li>
      <li><a href="_xE5_xB8_xB8_xE8_xA7_x81_xE9_x97_xAE_xE9_xA2_x98.html"><span>FAQs</span></a></li>
      <li><a href="_xE6_xB3_x95_xE5_xBE_x8B_xE5_xA3_xB0_xE6_x98_x8E.html"><span>Disclaimer</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="PageDoc"><div class="contents">
<div class="textblock"><div class="header" style="margin-left:-12px;margin-top:-10px;margin-right:-8px;"> <div class="headertitle"> <div class="title">Image Acquisition</div> </div> </div> <div id="shortdesc"> <br />
 </div><div id="shortdesc">The SDK supports the following 2 image acquisition methods: callback and polling. Select one as needed.</div><div id="shortdesc"> <ul>
<li>
<a href="#callback">Callback</a>: Acquire images via callback. </li>
<li>
<a href="#sequencer">Polling</a>: Acquire images via polling. </li>
</ul>
<dl class="section attention"><dt>Attention</dt><dd>These two methods cannot be used at the same time.</dd></dl>
<br />
 </div><div> <div id="callback"> <div class="mainparams"> <h2>Acquire Images via Callback</h2>
</div></div></div><div><div id="callback"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="callback"><div class="subparamswhite">You can register a callback for image acquisition in SDK. After getting images, SDK will call the custom callback function.</div></div></div><div><div id="callback"><div class="subparamswhite"> </div></div></div><div><div id="callback"><div class="subparamswhite"><b>Application</b>: Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#gaecc9206934d8184cc390b2b46c3269c8" title="Registers an image data callback.">MV_CC_RegisterImageCallBackEx()</a> or <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga2b179a3ca778dfdf91fca21737069464" title="Registers an image data callback.">MV_CC_RegisterImageCallBackEx2()</a> to register a callback.</div></div></div><div><div id="callback"><div class="subparamswhite"> <dl class="section attention"><dt>Attention</dt><dd><ul>
<li>
Time-consuming operations and thread locks are not recommended, because adding them may block the callback. </li>
<li>
pData is invalid and cannot be used again after callback ends. </li>
<li>
When registering a callback via <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga2b179a3ca778dfdf91fca21737069464" title="Registers an image data callback.">MV_CC_RegisterImageCallBackEx2()</a>, you can release the buffer manually or automatically. </li>
</ul>
</dd></dl>
</div></div></div><div><div id="callback"><div class="subparamswhite">The API calling flow is as follows:</div></div></div><div><div id="callback"><div class="subparamswhite"> <ol>
<li>
Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga75a7ebe5f3c3bd038bf0dc52c23970ff" title="Sets the number of nodes for SDK internal image buffer.">MV_CC_SetImageNodeNum()</a> to set the appropriate number of buffer nodes. <dl class="section note"><dt>Note</dt><dd>Set the appropriate number of buffer nodes as needed. Major factors include: camera frame rate, image solution, and computer configuration such as main board performance and memory.</dd></dl>
</li>
<li>
Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga2b179a3ca778dfdf91fca21737069464" title="Registers an image data callback.">MV_CC_RegisterImageCallBackEx2()</a> to register an image processing function. </li>
<li>
Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga379f992aec0ddd3170b0ef0f5f2306d7" title="Starts grabbing images.">MV_CC_StartGrabbing()</a> to start acquiring images. </li>
<li>
After receiving the images, SDK will process images via the custom image processing function. </li>
</ol>
</div></div></div><div><div id="callback"><div class="subparamswhite">The following sample codes show how to acquire images via callback: <ul>
<li>
<p class="startli"></p>
<p class="interli">Customize the callback function:</p>
<div class="fragment"><div class="line">FrameInfoCallBack2 = <a class="code" href="namespace_parametrize_camera___area_scan_i_o_settings.html#a3bae6d695a340d90cc6e249839d03825">winfun_ctype</a>(<span class="keywordtype">None</span>, POINTER(MV_FRAME_OUT), c_void_p, c_bool)</div><div class="line"></div><div class="line"><span class="keyword">def </span><a class="code" href="namespace_grab___callback.html#ad7791dc401035f14c0ea37270ea7ec1d">image_callback2</a>(pstFrame, pUser, bAutoFree):</div><div class="line">        stFrame = cast(pstFrame, POINTER(MV_FRAME_OUT)).contents</div><div class="line">        <span class="keywordflow">if</span> stFrame:</div><div class="line">            <span class="keywordflow">print</span> (<span class="stringliteral">&quot;get one frame: Width[%d], Height[%d], nFrameNum[%d]&quot;</span> % (stFrame.stFrameInfo.nWidth, stFrame.stFrameInfo.nHeight, stFrame.stFrameInfo.nFrameNum))</div><div class="line">        </div><div class="line">        <span class="comment">#Non-automatic release mode. Releasing resources manually is required.</span></div><div class="line">        <span class="keywordflow">if</span> bAutoFree == <span class="keyword">False</span> :</div><div class="line">            <span class="keywordflow">if</span> pUser != <span class="keywordtype">None</span>: </div><div class="line">                User = ctypes.cast(pUser, ctypes.py_object).value</div><div class="line">                User.MV_CC_FreeImageBuffer(stFrame)</div><div class="line">            <span class="keywordflow">else</span> :</div><div class="line">                <span class="keywordflow">print</span> (<span class="stringliteral">&quot;user is null, invalid&quot;</span>)</div><div class="line">        </div><div class="line"></div><div class="line">CALL_BACK_FUN2 = <a class="code" href="namespace_grab___callback.html#a23a769aafef7a6c7feae1d80b73615c4">FrameInfoCallBack2</a>(image_callback2)</div></div><!-- fragment -->  </li>
<li>
<p class="startli"></p>
<p class="interli">Register a callback for image grabbing and start acquiring images.</p>
<div class="fragment"><div class="line"><span class="comment">#Register an image grabbing callback</span></div><div class="line">ret = cam.MV_CC_RegisterImageCallBackEx2(CALL_BACK_FUN2, ctypes.py_object(cam), <span class="keyword">True</span>)</div><div class="line"><span class="keywordflow">if</span> ret != 0:</div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;register image callback fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    sys.exit()</div><div class="line"></div><div class="line"><span class="comment"># Start grabbing images</span></div><div class="line">ret = cam.MV_CC_StartGrabbing()</div><div class="line"><span class="keywordflow">if</span> ret != 0:</div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;start grabbing fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    sys.exit()</div></div><!-- fragment -->  </li>
</ul>
</div></div></div><div><div id="callback"><div class="subparamswhite"> </div> </div> <div id="sequencer"> <div class="mainparams"> <h2>Acquire Images via Polling</h2>
</div></div></div><div><div id="sequencer"><div class="mainparams"> </div> <div class="subparamswhite"> </div></div></div><div><div id="sequencer"><div class="subparamswhite">You can create a thread and get images via polling in the thread.</div></div></div><div><div id="sequencer"><div class="subparamswhite"> </div></div></div><div><div id="sequencer"><div class="subparamswhite">The API calling flow is as follows:</div></div></div><div><div id="sequencer"><div class="subparamswhite"> <ol>
<li>
<p class="startli"></p>
<p class="interli">Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga75a7ebe5f3c3bd038bf0dc52c23970ff" title="Sets the number of nodes for SDK internal image buffer.">MV_CC_SetImageNodeNum()</a> to set the appropriate number of buffer nodes in SDK. </p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>
The SDK receives the image data from the camera and caches it internally for external calls. If the upper layer calls are slow and the number of buffer nodes is limited, the SDK will have insufficient buffer to receive new image data, resulting in frame loss. </li>
<li>
Set the appropriate number of buffer nodes as needed. Major factors include camera frame rate, image solution, and computer configuration such as main board performance and memory. </li>
</ul>
</dd></dl>
</li>
<li>
<p class="startli"></p>
<p class="interli">Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga379f992aec0ddd3170b0ef0f5f2306d7" title="Starts grabbing images.">MV_CC_StartGrabbing()</a> to start acquiring images.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli">Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#gae49be0fa21399bad340b974b5ea89f57" title="Gets one frame of image using internal buffer.">MV_CC_GetImageBuffer()</a> in the application layer to get frame data in the specified pixel format.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>
You can set the timeout duration of this API. SDK waits for returned data before timeout. </li>
<li>
When getting image data, you can configure API calling frequency in the upper application layer according to the camera frame rate. </li>
</ul>
</dd></dl>
</li>
<li>
Process images through buffer operation. </li>
<li>
<p class="startli"></p>
<p class="interli">Call <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga6b8f32c675cdec2a44c648ee76262e83" title="Releases image buffer.">MV_CC_FreeImageBuffer()</a> to release the buffer.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>After calling <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#ga6b8f32c675cdec2a44c648ee76262e83" title="Releases image buffer.">MV_CC_FreeImageBuffer()</a>, buffer will be returned to SDK and be invalid. </li>
<li>The API <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86_xE4_xB8_x8E_xE6_xB8_xB2_xE6_x9F_x93.html#gae49be0fa21399bad340b974b5ea89f57" title="Gets one frame of image using internal buffer.">MV_CC_GetImageBuffer()</a> supports setting timeout duration. SDK waits for returned data before timeout.  </li>
</ul>
</dd></dl>
</li>
</ol>
</div></div></div><div><div id="sequencer"><div class="subparamswhite"> </div></div></div><div><div id="sequencer"><div class="subparamswhite">The following sample codes show how to acquire images via polling:</div></div></div><div><div id="sequencer"><div class="subparamswhite"> <ol>
<li>
<p class="startli"></p>
<p class="interli">Customize the thread function to receive and process images.</p>
<div class="fragment"><div class="line"><span class="comment"># Customize the thread function</span></div><div class="line"><span class="keyword">def </span><a class="code" href="namespace_connect_spec_camera.html#a7d6fa85fa33561934776205cf7d83b26">work_thread</a>(cam=0, pData=0, nDataSize=0):</div><div class="line">    stOutFrame = MV_FRAME_OUT()  </div><div class="line">    memset(byref(stOutFrame), 0, sizeof(stOutFrame))</div><div class="line">    <span class="keywordflow">while</span> <span class="keyword">True</span>:</div><div class="line">        ret = cam.MV_CC_GetImageBuffer(stOutFrame, 1000)</div><div class="line">        <span class="keywordflow">if</span> <span class="keywordtype">None</span> != stOutFrame.pBufAddr <span class="keywordflow">and</span> 0 == ret:</div><div class="line">            <span class="keywordflow">print</span> (<span class="stringliteral">&quot;get one frame: Width[%d], Height[%d], nFrameNum[%d]&quot;</span>  % (stOutFrame.stFrameInfo.nWidth, stOutFrame.stFrameInfo.nHeight, stOutFrame.stFrameInfo.nFrameNum))</div><div class="line">            nRet = cam.MV_CC_FreeImageBuffer(stOutFrame)</div><div class="line">        <span class="keywordflow">else</span>:</div><div class="line">            <span class="keywordflow">print</span> (<span class="stringliteral">&quot;no data[0x%x]&quot;</span> % ret)</div><div class="line">        <span class="keywordflow">if</span> g_bExit == <span class="keyword">True</span>:</div><div class="line">            <span class="keywordflow">break</span></div></div><!-- fragment -->  </li>
<li>
<p class="startli"></p>
<p class="interli">Start grabbing images.</p>
<div class="fragment"><div class="line"><span class="comment"># Start grabbing images</span></div><div class="line">ret = cam.MV_CC_StartGrabbing()</div><div class="line"><span class="keywordflow">if</span> ret != 0:</div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;start grabbing fail! ret[0x%x]&quot;</span> % ret)</div><div class="line">    sys.exit()</div><div class="line"></div><div class="line"><span class="keywordflow">try</span>:</div><div class="line">    hThreadHandle = threading.Thread(target=work_thread, args=(cam, <span class="keywordtype">None</span>, <span class="keywordtype">None</span>))</div><div class="line">    hThreadHandle.start()</div><div class="line"><span class="keywordflow">except</span>:</div><div class="line">    <span class="keywordflow">print</span> (<span class="stringliteral">&quot;error: unable to start thread&quot;</span>)</div></div><!-- fragment -->  </li>
</ol>
</div> </div></div><div> <div> <br />
 <br />
 <br />
 <table width="60%">
<tr>
<td>Previous: <a class="el" href="_xE4_xBA_x8B_xE4_xBB_xB6_xE5_x8F_x8A_xE5_xBC_x82_xE5_xB8_xB8.html">Event and Exception</a> </td><td>Next: <a class="el" href="_xE5_xA4_x84_xE7_x90_x86_xE5_x9B_xBE_xE5_x83_x8F.html">Image Processing</a>  </td></tr>
</table>
</div> </div> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<div class="footer" style="text-align: right;">
	<hr/>
	<small></small>
</div>
</body>
</html>