<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="custom-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
	<div style="overflow: hidden;">
		<div style="height: 57px;min-width: 1039px;background-size: auto 100%;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABwgAAAABCAYAAADKO/rAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABRSURBVFhH7dUxCoBADEXB5LK5/w1iIaLIrsgWNs50Sf/4WVUd8HOZGd1nCqMbGNMPrNMPrJv1cvz0A3OjfuwPvDPrxf7A7t7IlX7gmX74VsQGguw4S6+UnSYAAAAASUVORK5CYII=');">
			<img src="titleleft.png" style="float: left;"/>
			<img src="titleright.png" alt="" style="float: right;" />
		</div>
	</div>
<!-- 制作者 Doxygen 1.8.15 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>首页</span></a></li>
      <li><a href="_xE5_x8F_x91_xE7_x89_x88_xE8_xAF_xB4_xE6_x98_x8E.html"><span>发版说明</span></a></li>
      <li><a href="usergroup0.html"><span>编程引导</span></a></li>
      <li><a href="modules.html"><span>API参考</span></a></li>
      <li><a href="_xE7_xA4_xBA_xE4_xBE_x8B_xE7_xA8_x8B_xE5_xBA_x8F_xE6_xA6_x82_xE8_xA7_x88.html"><span>示例程序概览</span></a></li>
      <li><a href="_xE6_xB3_x95_xE5_xBE_x8B_xE5_xA3_xB0_xE6_x98_x8E.html"><span>法律声明</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="PageDoc"><div class="contents">
<div class="textblock"><div class="header" style="margin-left:-12px;margin-top:-10px;margin-right:-8px;"> <div class="headertitle"> <div class="title">采集图像</div> </div> </div> <div> <br />
 </div><div>可通过 <a class="el" href="interface_i_device.html" title="提供设备通用的属性和接口">IDevice</a> 的 <a class="el" href="interface_i_stream_grabber.html" title="提供取流相关接口">IStreamGrabber</a> 属性实现图像采集。 <a class="el" href="interface_i_stream_grabber.html" title="提供取流相关接口">IStreamGrabber</a> 提供开始采集、停止采集、获取图像信息等方法，也可以通过该属性配置图像采集相关的参数，如设置图像缓存节点个数，获取有效图像个数、设置取图策略等。</div><div> </div><div>SDK支持如下两种图像采集方式，可按需选用。</div><div> <ul>
<li>
回调取图：通过回调函数采集图像。 </li>
<li>
轮询取图：通过轮询调用取图接口采集图像。 </li>
</ul>
<dl class="section attention"><dt>注意</dt><dd>该两种采集图像的方式无法同时使用，只能使用其中一种。</dd></dl>
<div class="mainparams"> <h2 id="回调取图">回调取图</h2>
</div></div><div><div class="mainparams"> </div> <div class="subparamswhite"> </div></div><div><div class="subparamswhite">SDK提供“图像到来事件” FrameGrabedEvent ，您可在该事件上绑定自定义的事件处理函数。当SDK接收到图像时，SDK会自动触发该事件上绑定的事件处理函数。</div></div><div><div class="subparamswhite"> </div></div><div><div class="subparamswhite">该方式的基本步骤如下：</div></div><div><div class="subparamswhite"> <ol>
<li>
<p class="startli"></p>
<p class="interli">参考 <a class="el" href="interface_i_stream_grabber.html#ab46ec16c7096bae8fec2261e27b07074" title="采集一帧图像的事件，获取图像数据">IStreamGrabber.FrameGrabedEvent</a> ，定义自己的事件处理函数。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli">调用 <a class="el" href="interface_i_stream_grabber.html#a34f0db3e83dd83661f500b305c7bdf93" title="设置SDK内部图像缓存节点个数，大于等于1，在 IStreamGrabber.StartGrabbing() 前调用">IStreamGrabber.SetImageNodeNum()</a> ，设置合适的缓存节点个数。</p>
<dl class="section note"><dt>注解</dt><dd>具体申请多少块图像缓存需要根据实际情况决定，主要影响因素有：相机帧率、图像分辨率和电脑配置（主板性能、内存大小）等。</dd></dl>
</li>
<li>
<p class="startli"></p>
<p class="interli">调用 <a class="el" href="interface_i_stream_grabber.html#a3a77e754ee97eea5dc9b453aa2294cb1" title="开始取流">IStreamGrabber.StartGrabbing()</a> ，开始采集图像。</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p class="interli">等待事件触发，在自定义的事件处理函数中处理图像。</p>
<p class="endli"></p>
</li>
</ol>
</div></div><div><div class="subparamswhite">如下示例代码演示了该方式取图的过程 ：</div></div><div><div class="subparamswhite"> <ul>
<li>
<p class="startli"></p>
<p class="interli">自定义事件处理方法</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> FrameGrabedEventHandler(<span class="keywordtype">object</span> sender, <a class="code" href="class_frame_grabbed_event_args.html">FrameGrabbedEventArgs</a> e)</div><div class="line">{</div><div class="line">    Console.WriteLine(<span class="stringliteral">&quot;Get one frame: Width[{0}] , Height[{1}] , FrameNum[{2}]&quot;</span>, e.<a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.<a class="code" href="interface_i_frame_out.html#a926a2f7f8a8df31b3529d8a6b4e9cf1a">Image</a>.<a class="code" href="interface_i_image.html#ad1d4412942ac2ef39b05340ee4b9fac8">Width</a>, e.<a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.<a class="code" href="interface_i_frame_out.html#a926a2f7f8a8df31b3529d8a6b4e9cf1a">Image</a>.<a class="code" href="interface_i_image.html#af5b00bd33a696aa1637d4f6fe50722b5">Height</a>, e.<a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.<a class="code" href="interface_i_frame_out.html#ace9e98635eaaf4d8e4f5a5b42496263c">FrameNum</a>);</div><div class="line">}</div></div><!-- fragment -->  </li>
<li>
<p class="startli"></p>
<p class="interli">绑定事件，并开始采集</p>
<div class="fragment"><div class="line"><span class="comment">//ch: 设置合适的缓存节点数量 | en: Setting the appropriate number of image nodes</span></div><div class="line">device.StreamGrabber.SetImageNodeNum(5);</div><div class="line"></div><div class="line"><span class="comment">// ch:注册回调函数 | en:Register image callback</span></div><div class="line">device.StreamGrabber.FrameGrabedEvent += FrameGrabedEventHandler;</div><div class="line"></div><div class="line"><span class="comment">// ch:开启抓图 || en: start grab image</span></div><div class="line">ret = device.StreamGrabber.StartGrabbing();</div><div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">{</div><div class="line">    Console.WriteLine(<span class="stringliteral">&quot;Start grabbing failed:{0:x8}&quot;</span>, ret);</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Console.WriteLine(<span class="stringliteral">&quot;Press enter to exit&quot;</span>);</div><div class="line">Console.ReadLine();</div></div><!-- fragment -->  </li>
</ul>
</div> <div class="mainparams"> <h2 id="轮询取图">轮询取图</h2>
</div></div><div><div class="mainparams"> </div> <div class="subparamswhite"> </div></div><div><div class="subparamswhite">您可自行创建线程，在线程中循环调用 <a class="el" href="interface_i_stream_grabber.html#ae5f233c30512db03bb4005f5ee867cd7" title="获取一帧图像">IStreamGrabber.GetImageBuffer()</a> 获取图像信息。</div></div><div><div class="subparamswhite"> <dl class="section note"><dt>注解</dt><dd>由于图像缓存是SDK内部申请的，因此完成对图像的处理后，需要调用 <a class="el" href="interface_i_stream_grabber.html#a502f88a8d1cdca602ebe6431ffcf9cea" title="释放图像缓存（此接口用于释放不再使用的图像缓存，与 IStreamGrabber.GetImageBuffer() 配套使用）">IStreamGrabber.FreeImageBuffer()</a> 释放图像信息。</dd></dl>
<ol>
<li>
<p class="startli"></p>
<p class="interli">自定义线程函数，接收并处理图像</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> FrameGrabThread(<span class="keywordtype">object</span> obj)</div><div class="line">{</div><div class="line"><a class="code" href="interface_i_stream_grabber.html">IStreamGrabber</a> streamGrabber = (<a class="code" href="interface_i_stream_grabber.html">IStreamGrabber</a>)obj;</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(!_grabThreadExit)</div><div class="line">    {</div><div class="line">        <a class="code" href="interface_i_frame_out.html">IFrameOut</a> frame;</div><div class="line"></div><div class="line">        <span class="comment">//ch：获取一帧图像 | en: Get one frame</span></div><div class="line">        <span class="keywordtype">int</span> ret = streamGrabber.<a class="code" href="interface_i_stream_grabber.html#ae5f233c30512db03bb4005f5ee867cd7">GetImageBuffer</a>(1000, out frame);</div><div class="line">        <span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">        {</div><div class="line">            Console.WriteLine(<span class="stringliteral">&quot;Get Image failed:{0:x8}&quot;</span>, ret);</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        Console.WriteLine(<span class="stringliteral">&quot;Get one frame: Width[{0}] , Height[{1}] , FrameNum[{2}]&quot;</span>, frame.Image.Width, frame.Image.Height, frame.FrameNum);</div><div class="line"></div><div class="line">        <span class="comment">//Do some thing</span></div><div class="line"></div><div class="line">        <span class="comment">//ch: 释放图像缓存  | en: Release the image buffer</span></div><div class="line">        streamGrabber.<a class="code" href="interface_i_stream_grabber.html#a502f88a8d1cdca602ebe6431ffcf9cea">FreeImageBuffer</a>(frame);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment -->  </li>
<li>
<p class="startli"></p>
<p class="interli">开始采集</p>
<div class="fragment"><div class="line"><span class="comment">// ch:开启抓图 | en: start grab image</span></div><div class="line">ret = device.StreamGrabber.StartGrabbing();</div><div class="line"><span class="keywordflow">if</span> (ret != <a class="code" href="class_mv_error.html">MvError</a>.<a class="code" href="class_mv_error.html#aae781ef0f6a59940c564cc5bcaac1792">MV_OK</a>)</div><div class="line">{</div><div class="line">    Console.WriteLine(<span class="stringliteral">&quot;Start grabbing failed:{0:x8}&quot;</span>, ret);</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// ch:开启抓图线程 | en: Start the grabbing thread</span></div><div class="line">Thread GrabThread = <span class="keyword">new</span> Thread(FrameGrabThread);</div><div class="line">GrabThread.Start(device.StreamGrabber);</div><div class="line"></div><div class="line">Console.WriteLine(<span class="stringliteral">&quot;Press enter to exit&quot;</span>);</div><div class="line">Console.ReadLine();</div></div><!-- fragment -->  </li>
</ol>
</div> <div class="mainparams"> <h2 id="图像拷贝">图像拷贝</h2>
</div></div><div><div class="mainparams"> </div> <div class="subparamswhite"> </div></div><div><div class="subparamswhite">由于获取到的图像缓存都由SDK内部分配，处理完图像需要及时释放。若需对图像进行一些耗时操作，可复制一帧图像并保存至您的程序的数据队列中。<br />
您可调用 IFrame.Clone() 或 IFrame.Image.Clone() 对图像进行深拷贝。</div></div><div><div class="subparamswhite"> <div class="fragment"><div class="line"><span class="comment">// ch: 克隆图像数据（深拷贝） | en :Clone frame data using deep copy</span></div><div class="line"><a class="code" href="interface_i_frame_out.html">IFrameOut</a> frameCopy = (<a class="code" href="interface_i_frame_out.html">IFrameOut</a>)e.<a class="code" href="class_frame_grabbed_event_args.html#a3421d4467979ac4af71d1b5937757793">FrameOut</a>.Clone();</div></div><!-- fragment --> </div> </div> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<div class="footer" style="text-align: right;">
	<hr/>
	<small></small>
</div>
</body>
</html>